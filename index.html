<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Waqf Monetary Value Calculator — Gift Aid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind (for GH Pages demo) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- PropTypes (required by Recharts UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/prop-types@15/prop-types.min.js"></script>
  <!-- Recharts UMD -->
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"></script>
  <!-- Babel for inline JSX (demo only) -->
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6.26.0/babel.min.js"></script>
</head>
<body class="min-h-screen bg-[#F4F1E6]">
  <div id="root"></div>

  <script type="text/babel">
    const { useMemo, useState } = React;
    const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid, Legend } = window.Recharts;

    const fmtGBP = (n) => n.toLocaleString(undefined, { style: "currency", currency: "GBP", maximumFractionDigits: 2 });

    const frequencies = [
      { key: "oneoff", label: "One-off" },
      { key: "monthly", label: "Monthly" },
      { key: "weekly", label: "Weekly" },
      { key: "daily", label: "Daily" },
    ];

    const sharePresets = [
      { key: "emergency", name: "Emergency Aid Waqf", price: 100 },
      { key: "food", name: "Food Aid Waqf", price: 100 },
      { key: "orphans", name: "Orphans Care Waqf", price: 100 },
      { key: "health", name: "Health Care Waqf", price: 100 },
      { key: "livelihood", name: "Livelihood Support Waqf", price: 100 },
      { key: "water", name: "Water Aid Waqf", price: 100 },
      { key: "education", name: "Education Support Waqf", price: 100 },
      { key: "general", name: "General Charity Waqf", price: 100 },
      { key: "lightofsight", name: "Light of Sight Waqf", price: 4000 },
      { key: "iftar", name: "Ramadan Iftar Waqf", price: 2000 },
      { key: "qurbani", name: "Qurbani Waqf", price: 1800 },
      { key: "sadaqah", name: "Sadaqah Jariyah (min)", price: 3 },
      { key: "supportfund", name: "Waqf Support Fund (min)", price: 3 },
    ];

    function App() {
      // Inputs
      const [amount, setAmount] = useState(3);
      const [frequency, setFrequency] = useState("monthly");
      const [years, setYears] = useState(30);
      const applyAdminFees = true;                 // Admin fees ON in math (no toggle in UI)
      const [applyGiftAid, setApplyGiftAid] = useState(true); // Gift Aid toggle
      const [selectedPreset, setSelectedPreset] = useState(null);
      const [hoveredSeries, setHoveredSeries] = useState(null);

      // Fixed model
      const annualReturnPct = 8;   // gross income rate
      const reinvestPct     = 10;  // % of gross income reinvested

      const { series, finalStats } = useMemo(() => {
        let principal = 0;
        let cumulativeContrib = 0;        // donor out-of-pocket
        let cumulativeGiftAid = 0;        // Gift Aid added
        let cumulativeAdminFees = 0;      // on contribution + income
        let cumulativeIncome = 0;         // gross income from principal
        let cumulativeDistributed = 0;    // to projects (80% when fees on)

        const data = [];

        // Base annual contribution from user input
        const baseAnnualContribution = (() => {
          switch (frequency) {
            case "oneoff":  return amount;      // year 1 only
            case "monthly": return amount * 12;
            case "weekly":  return amount * 52;
            case "daily":   return amount * 365;
            default:         return 0;
          }
        })();

        for (let y = 0; y < years; y++) {
          // Contributions per year
          const baseContrib = (frequency === "oneoff" && y > 0) ? 0 : baseAnnualContribution;
          if (baseContrib > 0) {
            // Donor pays baseContrib; Gift Aid adds +25% if applied
            cumulativeContrib += baseContrib;
            const giftAid = applyGiftAid ? baseContrib * 0.25 : 0;
            cumulativeGiftAid += giftAid;

            const grossContrib = baseContrib + giftAid; // amount entering charity books
            const contribAdmin = applyAdminFees ? 0.10 * grossContrib : 0;
            cumulativeAdminFees += contribAdmin;

            principal += (grossContrib - contribAdmin); // net added to principal
          }

          // Investment year: income from principal
          const income = principal * (annualReturnPct / 100);
          cumulativeIncome += income;

          const adminOnIncome = applyAdminFees ? 0.10 * income : 0;
          cumulativeAdminFees += adminOnIncome;

          const reinvestAmt = (reinvestPct / 100) * income; // 10% of GROSS income
          const distributeAmt = income - reinvestAmt - adminOnIncome; // 80% to projects if fees on

          principal += reinvestAmt; // principal grows only by reinvested income
          cumulativeDistributed += distributeAmt;

          data.push({
            year: y + 1,
            principal,
            cumulativeIncome,
            totalValue: principal + cumulativeIncome,
          });
        }

        return {
          series: data,
          finalStats: {
            principal,
            cumulativeContrib,
            cumulativeGiftAid,
            cumulativeAdminFees,
            cumulativeIncome,
            cumulativeDistributed,
          },
        };
      }, [amount, frequency, years, applyGiftAid]); // removed applyAdminFees (constant)

      const last = finalStats;

      return (
        <div className="min-h-screen w-full text-[#02314B]">
          <div className="max-w-6xl mx-auto px-4 py-8">
            <header className="mb-6">
              <h1 className="text-3xl md:text-4xl font-bold tracking-tight text-[#8B003A]">Waqf Monetary Value Calculator — Gift Aid</h1>
              <p className="mt-2 max-w-3xl text-black">
                This version shows the effect of <span className="font-semibold">Gift Aid (+25%)</span> on contributions before fees, keeping
                income at <span className="font-semibold">8%</span> and reinvestment at <span className="font-semibold">10%</span>.
              </p>
            </header>

            {/* Section 1: Choose Waqf Share */}
            <section className="bg-white rounded-2xl border border-[#F4E1C3] shadow p-4 mb-8">
              <label className="block text-sm font-medium mb-1">Choose a Waqf Share</label>
              <select
                className="w-full border rounded-xl px-3 py-2"
                value={selectedPreset || ""}
                onChange={(e) => {
                  const key = e.target.value;
                  setSelectedPreset(key);
                  const preset = sharePresets.find((p) => p.key === key);
                  if (preset) setAmount(preset.price);
                }}
              >
                <option value="">-- Select a Share --</option>
                {sharePresets.map((p) => (
                  <option key={p.key} value={p.key}>{p.name} (£{p.price})</option>
                ))}
              </select>
            </section>

            {/* Section 2: Contribution Settings */}
            <section className="grid md:grid-cols-2 gap-4 mb-8">
              <div className="bg-white rounded-2xl border border-[#F4E1C3] shadow p-4">
                <label className="block text-sm font-medium mb-1">Contribution Amount (£)</label>
                <input
                  type="number" min={0} step={0.5} value={amount}
                  onChange={(e) => { setSelectedPreset(null); setAmount(Number(e.target.value)); }}
                  className="w-full border rounded-xl px-3 py-2"
                />

                <label className="block text-sm font-medium mt-4 mb-1">Frequency</label>
                <div className="flex
